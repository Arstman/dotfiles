#!/bin/sh
# Requires: xkb-switch-git

get_current() {
	current=$(setxkbmap -print | grep xkb_symbols | sed "s/^.*pc+//;s/+.*$//")
}

display_menu() {
	chosen=$(echo "us\nhu\ncl" | dmenu -r -i -p "Select layout:" -l 3)
	case "$chosen" in
		us)
			setxkbmap -model 'pc104' -layout 'us' -option -option 'compose:menu,caps:swapescape'
			;;
		hu)
			setxkbmap -model 'pc105' -layout 'hu' -variant '102_qwerty_dot_nodead' -option -option 'compose:menu,caps:swapescape'
			;;
		cl)
			setxkbmap -model 'pc104curl-z' -layout 'us(cmk_ed_us)' -option -option 'compose:menu,misc:cmk_curl_dh,caps:swapescape'
			;;
	esac
}

if [ $# -eq 0 ]; then
	get_current
	case "$current" in
		"us(cmk_ed_us)")
			echo "cl"
			;;
		"hu(*)")
			echo "hu"
			;;
		*)
			echo "$current"
			;;
	esac
	exit
fi

case "$1" in
	menu)
	    display_menu
		;;
esac

# Update dwmblocks module
# update signal: 12 + 34
kill -46 $(pidof dwmblocks)
